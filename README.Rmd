---
title: "Integrating geographic analysis in transport planning: new open source tools for a new era"
# title: "Integrating geographic analysis in transport planning: new tools of the trade"
# title: "Open source software for geographic analysis in transport planning"
# title: "Integrating geographic analysis in transport planning"
# title: "Integrating geographic analysis in transport planning workflows: the role of open source software
author: "Robin Lovelace"
date: '`r Sys.Date()`'
output:
  # word_document: default
  github_document: default
bibliography: references.bib
---

```{r, echo=FALSE, eval=FALSE}
# Priorty: write new tools of the trade section
# get citations
# refs_est = RefManageR::ReadZotero(group = "418217", .params = list(collection = "ABALWWZN", limit = 100))
# RefManageR::WriteBib(refs_est, "trafficEstimatr.bib")
refs_sof = RefManageR::ReadZotero(group = "418217", .params = list(collection = "JFR868KJ", limit = 100))
refs_gis = RefManageR::ReadZotero(group = "418217", .params = list(collection = "KUXG5CJL", limit = 100))
refs_geo = RefManageR::ReadZotero(group = "418217", .params = list(collection = "9K6FRP6N", limit = 100))
refs_tds = RefManageR::ReadZotero(group = "418217", .params = list(collection = "R38L2EXB", limit = 100))
refs = c(refs_sof, refs_gis, refs_geo, refs_tds)
refs_df = as.data.frame(refs)
# View(refs_df)
RefManageR::WriteBib(refs, "references.bib")
# citr::tidy_bib_file(rmd_file = "README.Rmd", messy_bibliography = "references.bib") # fails
library(tidyverse)
n_words = wordcountaddin::text_stats("README.Rmd")
word_count = readr::read_csv("word-count.csv")
word_count_new = rbind(word_count, data.frame(date = Sys.Date(), n_words))
readr::write_csv(word_count_new, "word-count.csv")
ggplot(word_count_new) +
  geom_line(aes(date, n_words)) +
  xlim(as.Date(c("2019-01-01", "2020-01-01"))) +
  ylim(0, 5000)
# f = "~/hd/books/David E. Boyce, Huw C.W.L. Williams/Forecasting Urban Travel (599)/Forecasting Urban Travel - David E. Boyce, Huw C.W.L. Williams.pdf"
# img_file <- pdftools::pdf_convert(f, format ='tiff', pages = 1:9, dpi = 400)
# txt = tesseract::ocr(img_file)
```

```{r, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Abstract {-}

Tools for working with geographic data have long been used in transport planning.
Transport is an inherently geographic activity, involving movement through space, along more or less complicated ways which, considered together, form interrelated spatial networks.
There is a strong case for geography being an *inbuilt* part of the transport planner's 'tools of the trade' --- software for transport data analysis, modelling and visualisation --- yet a dichotomy between 'geographic' and 'non-geographic' components persists.
<!-- workflows in academic, public sector and private consultancy transport planning contexts still tend to separate vital geographic processing and map making stages from the rest of the analysis. -->
This division damages transport planning in three main ways, by:
(1) reducing researcher effectiveness due to the time-consuming process of 'context switching';
(2) inhibiting reproducibility, requiring installation and management of geographic and non-geographic tools; and 
(3) reducing the visibility of vital geographic components in transport planning, with consequences for transport policy design.
Building on this premise, I make the case for and review open source solutions.
After an overview of the current software landscape, the paper proceeds to review three emerging software ecosystems that enable geographic analysis *to be embedded within* transport planning workflows: the statistical programming language R, the general purpose programming language Python, and the desktop geographic information system QGIS.
Although relatively young, each of these emerging ecosystems already provides new 'tools of the trade' for transport planners who need to use geographic data in their work.
Furthermore, the open source nature of these tools means that they can widen participation and make transport planning more transparent, reproducible and accessible.
<!--  transport planning experts and the public alike, -->
<!-- Ultimately, by highlighting cost effective and geographically targeted interventions, integrating geographic analysis in transport planning could lead to better decision making. -->
<!-- and support the global efforts to transition away from fossil fuels and towards a healthy, low carbon transport system. -->

# Introduction: the importance of geographic analysis in transport planning
<!-- Should that heading omit the "Introduction:" part? -->

Transport planning is an applied discipline involving the design and placement of physical infrastructure, including highways, railways, cycleways and footways [@oflaherty_transport_1997; @parkin_designing_2018].
It also involves visioning transport futures and making the economic and political case for change [@timms_imagineering_2014].
Successful transport plans are therefore a combination of geographically specific recommendations (e.g. "build this way here") and long-term strategies guided by citywide, regional and even national visions.
The rewards can be great: transport planners who have designed --- and helped to implement --- plans appropriate to the needs of an area leave a legacy that will benefit people and the environment for generations to come.^[
Articles about successful transport planners illustrate the point.
Ben Hamilton-Baillie (1955 - 2019), for example, was an influential transport planner and street designer whose obituary stated that "hundreds of thousands of people who are safer and happier as a result of his achievements" (Tim Stornor, quoted in [TransportExtra](https://www.transportxtra.com/publications/local-transport-today/news/60655/obituary-ben-hamilton-baillie/)).
]
Transport planning can be considered as "more of an art than a technique", although *good* transport plans also rely on robust analysis and modelling of sometimes large and usually spatial input datsets  [@ortuzar_modelling_2001].
Ways and other pieces of transport infrastructure must *go somewhere* to optimise their ability to take people *where they want to go*, yet the importance of geography in transport systems is often overlooked [@rodrigue_geography_2013].
Transport planning is thus embedded within broader democratic processes *and* local geographic contexts.

Effective transport planning is inherently embedded within democratic processes (to the extent that democracy exists in the area where transport plans are commissioned) because it determines how public spaces and other shared resources are used, affecting everyone in society.
If transport plans are developed by unaccountable technocrats with little understanding of their impacts, the results can be severe: the transport system now is the "leading cause of death for children and young adults aged 5-29 years" through road traffic casualties alone, with 1.35 million people killed and tens of millions injured and disabled each year [@world_health_organization_global_2018].
The air pollution impacts could be even greater, with a growing body of research linking air pollution to Alzheimer's disease, lung cancer and heart disease among hundreds of millions of sufferers worldwide [@kampa_human_2008; @kilian_emerging_2018].
Transport is responsible for a quarter of global greenhouse gas emissions and growing [@harrison_environmental_2017], and is one of the hardest sectors to decarbonise [@moriarty_prospects_2008], meaning that evidence-based plans to reduce transport energy use is an urgent priority affecting the global population, especially the projected 1.4 billion people who will live in low elevation (less than 10 m above sea level) coastal zones by 2060 [@neumann_future_2015].

Transport planning is also inherently embedded within local geographic contexts because transport systems, and the networks of physical infrastructure that underpins them, are highly localised [@barthelemy_spatial_2011; @levinson_network_2012] and to some degree dynamic [@xie_evolving_2011] phenomena.
Transport planning is therefore fundamentally a *spatial activity*.
Perhaps in response to an upsurge in the amount of geographic transport data available, interest in Transport Geography seems to have grown over the last decade relative to other terms, according to data from Google Trends (Figure 1).
It is interesting to compare this growth with relative levels of interest in 'geographic information systems' and 'spatial planning', both of which seem to have seen relative declines over time, notwithstanding the limitations associated with search data [@mellon_internet_2014]. 

```{r, eval=FALSE}
library(gtrendsR)
# res_all <- gtrends(c("transport geography", "geographic information systems", "geocomputation"), time = "all")
res <- gtrends(c("transport geography", "geographic information systems", "spatial planning"), time = "2010-01-01 2019-06-01")
head(res$interest_over_time)
unique(res$interest_over_time$keyword)
nrow(res$interest_over_time) / 3 / 12
res$interest_over_time$date = rep(seq(from = as.Date("2010-01-01"), to = as.Date("2019-06-01"), length.out = 114), 3)
start_rows = 1
end_rows = nrow(res$interest_over_time) / 3

res$interest_over_time$hits_smoothed = c(
  zoo::rollmean(res$interest_over_time$hits[start_rows:end_rows], 6, fill = "extend"),
  zoo::rollmean(res$interest_over_time$hits[(start_rows:end_rows) + end_rows], 6, fill = "extend"),
  zoo::rollmean(res$interest_over_time$hits[(start_rows:end_rows) + 2 * end_rows], 6, fill = "extend")
)
ggplot(res$interest_over_time) +
  geom_line(aes(date, hits_smoothed, colour = keyword)) +
  ylab("Relative number of hits")
ggplot2::ggsave("google-trends.png")
```

```{r, fig.cap="Relative level of interest in search terms related to 'geographic information systems', 'geocomputation' and 'transport geography' inferred from google search data. Thanks to the **gtrendsR** R package [@massicotte_gtrendsr:_2019], code to reproduce the plot is hosted in this paper's code repository.", out.width="70%"}
knitr::include_graphics("google-trends.png")
```

The concept of integrating geographic data analysis in transport planning is not new (although tools for integrating geographic data are).
Geographic perspectives have contributed to the transport planning for over 100 years, as documented in papers on geographic considerations in railway design [@buxton_balkan_1908] and national engineering challenges [@farnham_relation_1912], to take just a couple of pre-war examples.

In the inter-war period (1918-1939), interest in Transport Geography seems to have grown, although a disciplinary home for transport research (let alone geographic transport research) had yet to emerge and the term 'transport geography' itself was vanishingly rare.
A few papers from the period demonstrate the growing interest in the topic, and understanding of geographic thinking to understand evolving transport systems.
@paterson_horse_1926 speculated quite accurately on the continued rise of motor traffic at the expense of horse powered transport during the 20^th^ Century, noting the importance of geographic factors in determining mode choice, down to the street level:
"Many streets, like our Bond Street, Watling Street or Lombard Street, and in Seville, the Calle de las Sierpes or Kalver Straat in Amsterdam, may be unsuited to motor traffic, and frontage values may be so high that widening can hardly be considered."
In a geographic review of Japanese cities @trewartha_japanese_1934 also alluded to the relationship between geography and mode choice:
"widening and paving of [roads] have (sic) been accomplished [allowing] numerous taxis, motor busses, and tram cars contrasting with the slow human and animal-drawn carts and the ubiquitous bicycle".
Rapid industrialisation during the largely unconscious build-up to World War II was associated with major road building schemes in many developed regions, demanding the practical application of new methods from a range of disciplines [e.g. @greenshields_studying_1936].
In the USA, highway engineering even became a recommended case study for geography lessons [@fox_main_1923].

```{r, echo=FALSE, eval=FALSE}
txt = tesseract::ocr("/tmp/a515a55e15285bf2fd100fd1d8edd91c.pdf")
writeLines(txt, "/tmp/txt.txt")
file.edit("/tmp/txt.txt")
```



geographic 


Around the turn of the century, there were attempts to define geographic information systems for transportation (GIS-T) as a self-standing academic field [@miller_potential_1999], something that has not caught on.

<!-- Search term for interwar period: https://scholar.google.co.uk/scholar?q="transport+geography" -->
<!-- something on the Journal of Transport Geography? -->

The growing research interest in the subject is also reflected in teaching.
Modules dedicated to Transport Geography have been advertised at the Universities of Aberdeen and Hofstra and, at the University of Leeds the Masters module Sustainable Spatial Planning and Analysis ([SSPA](https://github.com/ITSLeeds/SSPA)) is focussed on GIS skills for transport planning (declaration of interest: I teach on this module).
There are even dedicated 3 year degrees Transport Geography.
<!-- something on the lack of open source? -->

<!-- https://www.abdn.ac.uk/registry/courses/undergraduate/2016-2017/geography/gg4016
https://people.hofstra.edu/jean-paul_rodrigue/course_transport.html
 in Geography with Transport Studies BA advertised by the University of Leeds
-->

Where is existing infrastructure and 'demand' (current and potential travel) located?
How will transport patterns shift in the future?
And where will different types of intervention be most effective?
Tools that can help answer these questions are becoming an increasingly important part of the transport planner's cabinet [@te_brommelstroet_developing_2008].

To illustrate this point, imagine fundamental changes that could be made to tax system in support a transition away from fossil fuels.
Interventions such as carbon taxes would undoubtedly have geographic implications, but the intervention itself (charging a fixed price for the extraction and sale of atmosphere polluting substances) could be essentially non-geographic.
Notwithstanding changes to national policies relating to transport, transport planning interventions, by contrast, are inherently spatial.
Even high level national plans for a walking and cycling revolution must be implemented locally, down to the level of streets, as illustrated by the still ongoing local implementation of Dutch cycling ambitions [@pucher_making_2008]. 
The political-democratic and local-geographic aspects of transport planning can be considered in isolation, but an integrated approach is necessary for effective policies [@hull_policy_2008].
This is well illustrated by prominent Mayoral transport policies in cities such as 
London[^1],
Paris^[
The current Mayor of Paris, Anne Hidalgo, sees transport as a priority and has plans to make public transport free. See 
[paris.fr](https://www.paris.fr/rechercher/transport).
],
and Bogotá^[
Bogotá has an innovative and prominent transport policy, led by the two times mayor Enrique Peñalosa, who has led the roll-out of major bus and cycleway projects in the city. See [sitp.gov.co](https://www.sitp.gov.co/).
].


[^1]: Transport is a major electoral issue in London and the current Mayor, Sadiq Kahn, has made tackling air pollution a policy priority. See [tfl.gov.uk/corporate/about-tfl/the-mayors-transport-strategy](https://tfl.gov.uk/corporate/about-tfl/the-mayors-transport-strategy).

With such issues --- climate change, air pollution, obesity and social inequalities --- high on the political agenda, and the benefits for 'early adopters' of evidence-based interventions to accelerate the shift away from the motor car in cities such as London, Paris and Bogotá, pressure is growing on local, city and national transport planning departments to act.
But what should they do?
This *policy* question raises important *research* questions:
Which methods are most suitable for designing future transport systems?
What is the evidence base, and analysis, that should be used to inform transition towards a healthy, zero carbon transport system?
Which interventions, from the multitude of options available, are most likely to be effective?
And where are different types of intervention most likely to succeed?
The premise of this paper is that new approaches, enabled by software, are needed to provide answers to these questions.
21^st^ century demands for transport planning cannot be delivered by 20^th^ century technology and, this paper will argue, open source solutions are poised to bridge the gap between the geographic and the --- historically dominant --- non-geographic aspects of transport planning.
The 21^st^ Century also requires new transport planning methodologies which, as this paper outlines, increasingly involves geographic analysis.
Furthermore, the policy context increasingly demands transparency and citizen involvement in the decision-making process, which only software that is open source and reliably deliver, making an exploration of open source options for transport planning workflows timely.

Methods for transport planning are by no means static.
They are constantly evolving in response to policy drivers and technological change [@boyce_forecasting_2015].
Of course, transport policies that are evidence-based and grounded in realistic models of change under different scenarios of the future are far more likely to be successful than policies based on ideological commitment and good intentions alone.
With unprecedented access to increasingly detailed datasets on transport behaviours and infrastructure, transport planners today can make their designs are more evidence-based that ever, provided they have access to tools that enable them to make sense of this 'data revolution' [@transport_systems_catapult_transport_2015].
The sheer volume and complexity of new datasets require new approaches that can scale and integrate multiple data sources [@lovelace_big_2016].
Furthermore, advances in software and hardware allow not only for current transport systems to be modelled at high temporal and geographic resolution, but for future scenarios and 'model experiments' to be developed, which can support identification and implementation of the most effective interventions [@klosterman_what_1999].
With the explosion in open source software, which has come to dominate data science, there is now also a unique opportunity for transport planning to become a more transparent and democratically accountable enterprise.

Unfortunately, the dream of data driven, participatory and open transport planning is far from reality.
Transport planning has been slow to adapt to the data revolution and, while it evolves to enable a wider range of input data sources and analysis 'in the cloud', the open source element is conspicuously lacking.

The paper outlines how the 'division of labour' between geographic and non-geographic aspects of transport planning emerged, in relation to the historical specialisation and monopolisation of particular transport planning software products, based on existing literature and an understanding of landscape of tools used in practice (Section 2).
Section 3 reviews open source software ecosystems that enable an integrated approach, which combines non geographically explicit stages (e.g. modelling) and geographic processing stages *in a single workflow*.
Three software ecosystems (R, Python and QGIS) are reviewed in detail; alternative current and potential future approaches, including 'cloud lock in' are discussed; and the relative merits of different approaches are discussed.
Building on this discussion, the paper concludes by returning to the importance of integrating data analysis and geographic processing in a single analysis.
The final section also outlines concrete steps that researchers, public sector transport planners, and transport planning analysts and consultants can take to accelerate the transition to open source software in transport planning which will, in turn, support policies that accelerate the transition to healthy and zero carbon transport systems.

<!-- The paper concludes that 'integrated approach' can support efficient, scalable and reproducible transport planning workflows which can provide a strong and transparent evidence base needed for rapid transition away from fossil fuels in the transport sector. -->

# The landscape of transport planning software

Before describing the existing landscape, it is worth outline what transport planning software is.
Software for transport planning can be grouped by the scale at which it operates, with broad categories being 'micro' and 'macro' models [@kotusevski_review_2009].
'Microscopic' transport models represent individual vehicles on the road network and are therefore able to represent localised phenomena such as traffic congestion.
Macro models, by contrast, represent aggregates of vehicular traffic over large spatial scales, with a focus on the implications of future changes in transport behaviour and infrastructure on flow at the route network level.
Of course the distinction is, in reality, an oversimplification: there is a continuum between micro and macro transport modelling software.
With advances in computer hardware and software, an increasing number of developers are attempting to combine both approaches into a single system.
In this paper we focus on macro models, and their geographic representation, rather than micro models. 

The geographic and non-geographic division of labour is a result of the history of transport planning software.
This history is detailed in Chapter 10 of *Forecasting Urban Travel* [@boyce_forecasting_2015].
Titled "Computing environment and travel forecasting software", the chapter provides a unique insight into the software packages that have been popular in transport planning over the years.
Of course, software development has always depended on the physical hardware on which it runs and the early days of transport planning software were characterised by bespoke programs running on mainframe computers and maintained by domain experts.
Transport planning bodies and researchers in the USA led developments in the 1960s and 1970s when computers first started to be used for transport planning, when the main problem that they addressed was how to deal with the explosive growth in car ownership and use that was taking place during those decades.
More overtly political factors also influenced the direction of transport planning software: 
"certain private firms complained to US DoT [Department of Transport] that its agencies were developing software in competition with the private sector", leading to the abandonment of publicly funded transport planning software development projects, notably UTPS.^[
UTPS stands for the UMT (Urban Mass Transportation Administration, an agency of the DoT responsible for transport planning) Transportation Planning System (UTPS) and PLANPAC
]
This contrasts with the history of GRASS, a publicly funded GIS system that has been under continuous development by state, academic and commercial organisation since 1982 [@neteler_open_2008].
Would the landscape of transport planning software have been different if the DoT had continued to fund software development projects?
That question is outside the scope of this paper.
What is certain, however, is that software used in transport planning over the past three decades has been dominated by companies and that the sector has been slow to adopt open an open source approach.


In response to the 'siloed' development of GIS and transport software, there have been calls for greater integration.
@loidl_gis_2016, building on the observation that "geography and GIS remained a niche topic within traditional transport modeling", made a case for strengthening the 'spatial perspective' in transport modelling.
The paper emphasised the growing importance of well-defined data types, disaggregating detailed (and difficult to interpret) transport model outputs, and geographic data visualisation and concluded that much further research is needed:
"future research and development is needed to combine geospatial functionalities with transport modeling,
while providing an efficient, interactive, visual interface for data exploration, manipulation, analysis
and visualization" [@loidl_gis_2016].
Although the paper focussed on conceptual issues rather than software per-se, it did identify mention four open source programming languages that could provide the foundation for future developments, two of which (R and Python) are covered in the next section.

Data preprocessing and analysis stages are generally done in dedicated transport planning and spreadsheet software.
Geographic analysis and cartographic visualisation stages are generally done in a dedicated 'geographic information system' (GIS).


# New tools of the trade: open source software for integrated geographic analysis

## R

[@r_core_team_r:_2019]

[@bivand_implementing_2006]

[@pebesma_software_2015]


[@bivand_applied_2013]


## Python

[@rossum_python_1995]


## QGIS

[@qgis_development_team_qgis_2019]

# Conclusion

# References
